# 64位模式初始化时内存地址分配

|地址|内容|
|---|---|
|0x500|elf内核头|
|0x700|entry_64|
|0x900|内核实际入口(main函数入口)|
|0x904|e820探测内存块数量|
|0x908|e820探测内存块结构体初始地址|
|0x1000|四级页表|
|0x2000|三级页表|
|0x3000|二级页表|
|0x4000|一级页表|
|0x5000|一张4K页表结束位置|
|0x7c00|boot|
|0x100000|内核代码开头|

# 分页

四级页表，每页512项

|页表|粒度|
|---|---|
|4|0.5T|
|3|1G|
|2|2M|
|1|4k|

# kernel空间分配

x = KERNEL_CODE_END(align 4k)

栈的虚拟地址下面的虚拟页不分配物理页，如果缺页地址是该虚拟页，可以判断为stackoverflow

|物理地址|内容|
|---|---|
|0x100000|内核代码段(text + rodata + data + bss)|
|x|4k stack|
|x + 4k|4-level page table|